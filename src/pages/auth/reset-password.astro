---
import Layout from "@/layouts/Layout.astro";
import { ResetPasswordForm } from "@/components/auth/ResetPasswordForm";
import { createSupabaseServerInstance } from "@/lib/supabase";

// Check if user has a valid reset token
const supabase = createSupabaseServerInstance({
  cookies: Astro.cookies,
  headers: Astro.request.headers,
});

const {
  data: { user },
} = await supabase.auth.getUser();

// If user is logged in, redirect to quotations
if (user) {
  return Astro.redirect("/quotations");
}

// Get the token from the URL
const token = Astro.url.searchParams.get("token");

// If no token is present, redirect to login
if (!token) {
  return Astro.redirect("/auth/login");
}
---

<Layout title="Resetowanie hasÅ‚a">
  <main class="container mx-auto px-4 py-8">
    <div class="min-h-[calc(100vh-16rem)] flex items-center justify-center">
      <ResetPasswordForm client:load />
    </div>
  </main>
</Layout>
